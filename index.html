<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿æŠ½ç­¾ç¥å™¨</title>
    <!-- ä½¿ç”¨ Tailwind CSS è¿›è¡Œç¾åŒ– -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ç®€å•çš„è‡ªå®šä¹‰åŠ¨ç”» */
        @keyframes pop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: pop 0.3s ease-out forwards;
        }
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-200 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6 space-y-6">
        
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800">âœ¨ å¹¸è¿æŠ½ç­¾ âœ¨</h1>
            <p class="text-gray-500 text-sm mt-2">å…¬å¹³ã€å…¬æ­£ã€å…¬å¼€</p>
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="space-y-3">
            <label class="block text-sm font-medium text-gray-700">åå•åˆ—è¡¨ï¼ˆæ‰‹åŠ¨è¾“å…¥æˆ–ä¸Šä¼ ï¼‰</label>
            
            <!-- æ–‡æœ¬æ¡†ï¼šå¯ä»¥ç›´æ¥ç²˜è´´åå­— -->
            <!-- ä¿®æ”¹ï¼šrows="3" è°ƒä½é«˜åº¦ -->
            <textarea id="nameInput" rows="3" 
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition text-gray-700 placeholder-gray-400"
                placeholder="è¾“å…¥åå­—ï¼Œæ¯è¡Œä¸€ä¸ª&#10;å¼ ä¸‰&#10;æå››&#10;ç‹äº”"></textarea>
            
            <!-- æ–‡ä»¶ä¸Šä¼  & æ¨¡æ¿ä¸‹è½½ -->
            <div class="flex items-center justify-between space-x-2">
                <!-- ä¿®æ”¹ï¼šfile:py-3 file:px-6 file:text-base å¢å¤§æŒ‰é’® -->
                <input type="file" id="csvFile" accept=".csv" 
                    class="block w-full text-sm text-gray-500 file:mr-4 file:py-3 file:px-6 file:rounded-full file:border-0 file:text-base file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100 cursor-pointer"/>
                
                <!-- æ–°å¢ï¼šä¸‹è½½æ¨¡æ¿æŒ‰é’® (ä¸ºäº†è§£å†³ä¹±ç é—®é¢˜) -->
                <button onclick="downloadTemplate()" class="whitespace-nowrap text-xs text-purple-600 underline hover:text-purple-800">
                    ä¸‹è½½ç¤ºä¾‹CSV
                </button>
            </div>
            <p class="text-xs text-gray-400">*ä¸Šä¼ CSVæ–‡ä»¶åï¼Œåå•ä¼šè‡ªåŠ¨å¡«å……åˆ°ä¸Šæ–¹</p>
        </div>

        <!-- æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
        <div class="grid grid-cols-2 gap-4">
            <!-- æ‰€æœ‰çš„åˆ†ç»„æŒ‰é’®å·²è¢«ç§»é™¤ï¼Œåªä¿ç•™æŠ½ç­¾ -->
            <button onclick="drawOne()" 
                class="col-span-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:-translate-y-1 hover:shadow-xl active:translate-y-0">
                ğŸ² æŠ½ä¸€äºº
            </button>
            <button onclick="reset()" 
                class="col-span-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-6 rounded-xl transition">
                ğŸ”„ é‡ç½®
            </button>
        </div>

        <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
        <div id="resultArea" class="hidden bg-purple-50 rounded-xl p-6 border-2 border-purple-100 text-center">
            <h2 class="text-xl font-semibold text-purple-900 mb-2">ğŸ‰ ä¸­ç­¾åå• ğŸ‰</h2>
            <div id="resultContent" class="text-2xl font-bold text-purple-600 break-words animate-pop">
                <!-- ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </div>

    </div>

    <script>
        // æ ¸å¿ƒæ•°æ®
        let names = [];

        // 1. ä¸‹è½½é˜²ä¹±ç çš„ CSV æ¨¡æ¿
        function downloadTemplate() {
            // \uFEFF æ˜¯ BOM å¤´ï¼Œå‘Šè¯‰ Excel "æˆ‘æ˜¯ UTF-8 ç¼–ç "ï¼Œé˜²æ­¢ä¹±ç 
            const content = "\uFEFFå§“å\nå¼ ä¸‰\næå››\nç‹äº”\nèµµå…­";
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "åå•æ¨¡æ¿.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 2. å¤„ç†æ–‡ä»¶ä¸Šä¼  (å·²å‡çº§ï¼šè‡ªåŠ¨å…¼å®¹ UTF-8 å’Œ GBK ç¼–ç )
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            
            // å…³é”®ä¿®æ”¹ï¼šç”¨ ArrayBuffer è¯»å–ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­â€œçŒœâ€ç¼–ç 
            reader.readAsArrayBuffer(file);

            reader.onload = function(e) {
                const buffer = e.target.result;
                let text = '';
                
                // ç¬¬ä¸€æ­¥ï¼šå…ˆè¯•æ¢æ€§åœ°ç”¨ UTF-8 è§£ç 
                // fatal: true è¡¨ç¤ºå¦‚æœå‘ç°ä¸ç¬¦åˆ UTF-8 è§„åˆ™çš„å­—èŠ‚ï¼Œç›´æ¥æŠ¥é”™ï¼Œè½¬å…¥ catch
                const utf8Decoder = new TextDecoder('utf-8', { fatal: true });
                
                try {
                    text = utf8Decoder.decode(buffer);
                } catch (err) {
                    // ç¬¬äºŒæ­¥ï¼šå¦‚æœæŠ¥é”™äº†ï¼Œè¯´æ˜ä¸æ˜¯ UTF-8ï¼Œé‚£è‚¯å®šæ˜¯ GBK (Excelé»˜è®¤ä¿å­˜æ ¼å¼)
                    console.log('UTF-8 è§£æå¤±è´¥ï¼Œåˆ‡æ¢ä¸º GBK æ¨¡å¼...');
                    const gbkDecoder = new TextDecoder('gbk');
                    text = gbkDecoder.decode(buffer);
                }

                // åç»­å¤„ç†é€»è¾‘ä¸å˜
                const rows = text.split(/\r\n|\n/);
                const cleanNames = rows
                    .map(row => row.trim())
                    // å…¼å®¹å¤„ç†ï¼šæœ‰äº›CSVå¯èƒ½æœ‰é€—å·ï¼Œåªå–é€—å·å‰ç¬¬ä¸€åˆ—ï¼Œæˆ–è€…æ•´è¡Œ
                    .map(row => row.split(',')[0]) 
                    .filter(row => row && row !== 'å§“å' && row !== 'Name');
                
                document.getElementById('nameInput').value = cleanNames.join('\n');
            };

            reader.onerror = function() {
                alert('è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
            };
        });

        // 3. è·å–åå•å·¥å…·å‡½æ•°
        function getNames() {
            const input = document.getElementById('nameInput').value;
            // è¿‡æ»¤ç©ºè¡Œ
            return input.split('\n').map(n => n.trim()).filter(n => n);
        }

        // 4. æŠ½ç­¾é€»è¾‘ (æŠ½ä¸€äºº)
        function drawOne() {
            const currentNames = getNames();
            if (currentNames.length === 0) {
                alert('å®å­ï¼Œåå•æ˜¯ç©ºçš„å‘€ï¼å…ˆè¾“å…¥æˆ–ä¸Šä¼ åå­—å“¦~');
                return;
            }

            // éšæœºé€‰ä¸€ä¸ª
            const randomIndex = Math.floor(Math.random() * currentNames.length);
            const winner = currentNames[randomIndex];

            showResult(winner);
        }

        // 5. å±•ç¤ºç»“æœ
        function showResult(content) {
            const resultArea = document.getElementById('resultArea');
            const resultContent = document.getElementById('resultContent');
            
            resultArea.classList.remove('hidden');
            // é‡æ–°è§¦å‘åŠ¨ç”»
            resultContent.classList.remove('animate-pop');
            void resultContent.offsetWidth; // è§¦å‘é‡ç»˜
            resultContent.classList.add('animate-pop');
            
            resultContent.textContent = content;
        }

        // 6. é‡ç½®
        function reset() {
            document.getElementById('nameInput').value = '';
            document.getElementById('csvFile').value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
            document.getElementById('resultArea').classList.add('hidden');
        }
    </script>
</body>
</html>
